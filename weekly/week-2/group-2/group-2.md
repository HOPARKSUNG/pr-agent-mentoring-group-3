# 2주차 조별 과제

-  PR Agent 아키텍처 및 주요 기능
-  AI 코드리뷰의 현재 동향과 미래 전망
-  다양한 AI 코드리뷰 도구의 비교 분석

---

## PR Agent

### 소개

- GitHub Pull Request에 AI 기반 코멘트를 자동으로 남겨주는 오픈소스 프로젝트
- 코드 변경 사항을 분석하고, 잠재적인 문제를 파악하여 개선 사항을 제안할 수 있는 AI 기반 도구
- PR Agent는 자동화를 활용하여 PR 관리를 더 빠르고 원활하게 함
- 보안 취약점을 탐지하거나 테스트를 생성해주는 기능에 대해서는 유료이다.

### 아키텍쳐

PR Agent는 크게 3계층 구조를 가진다.

#### Event Listener / Git Integration Layer

- 연동 플랫폼: GitHub, GitLab, Bitbucket, Azure DevOps
- 작동 방식:
  - PR 생성, 수정, 코멘트 이벤트를 감지 (pull_request, pull_request_review_comment, issue_comment)   
  - 이벤트 발생 시 PR 메타데이터 및 변경된 파일 정보(diff, patch)를 수집
  - Core 분석 모듈에 이벤트를 전달하여 작업 시작

- 지원 형식:
  - GitHub App: 웹훅 + GitHub REST API 사용
  - GitHub Action: 워크플로우로 연동, 커스텀 액션 지원
  - CLI 툴: 로컬 실행 가능, 배치 분석에 유리
  - Docker 컨테이너: 온프레미스/자가 호스팅 환경 최적화

#### Core 분석 모듈

1. PR 메타데이터 수집

- 변경된 파일 리스트, diff chunk, PR 제목/본문 등 메타데이터 추출   
- 파일 타입 필터링 (예: .py, .java 등 주요 소스 파일만)

2. 요약
- 전체 변경사항 요약 (파일별, 변경 단위별)   
- LLM에 넘기기 전에 토큰 최적화 작업

3. 구조 분석

- 함수 추가/삭제 탐지 , 클래스 변경   
- 중복 코드, 너무 큰 함수, 코드 스타일 일관성 탐지   

4. LLM 질의

- Diff 내용을 기반으로 코드 리뷰 요청     

5. 결과 파싱 및 후처리

- LLM 응답을 파싱하여 코드 줄번호와 연결    
- 잘못된 지적, 부정확한 코멘트는 필터링   
- 필요한 경우, 짧은 코멘트로 분할해서 다시 정리   

#### Output Generation / Interaction Layer

PR 코멘트 자동 작성

- GitHub Comment API를 사용해 자동으로 코드 줄 단위 또는 PR 코멘트작성
- PR Review API를 통해 리뷰 제출 까지 자동화 가능

명령어(슬래시 커맨드) 처리 기능

- `/review`: 전체 PR에 대한 코드 리뷰 요청
- `/describe`: 변경사항 요약
- `/improve`: 코드 개선 제안 생성 (Refactoring 예시 제공)
- `/ask`: 자유 질문/답변

| 상황 | 추천 기능 | 실행 방식 |
| --- | --- | --- |
| PR을 처음 생성했을 때 | `자동 리뷰 + 요약` | 자동 |
| PR 설명이 부실할 때 | `PR 설명 개선` | 자동 또는 `/improve` 수동 실행 |
| 변경 코드가 많아서 요약이 필요할 때 | `요약 기능` | `/describe` |
| 리뷰 코멘트가 부족할 때 | `리뷰 보강` | `/review` |
| 특정 로직이 이해 안될 때 | `질문 기능` | `/ask` |

### PR Agent의 프롬프트 최적화

PR에 포함된 내용은 클수도 있고 (backend → main), 작을 수도 있다(hotfix → main) 이 두가지 상황 모두 효율적으로 프롬프트에 담기 위해 다음과 같이 처리한다.

#### 공통

Repo language prioritization strategy

1. 바이너리 파일, 이미지, pdf와 같은 코드가 아닌 파일들을 제외
2. 레포에서 가장 많이 사용된 언어 기준으로 파일을 정렬

#### Small PR

각 변경 패치 앞뒤 3줄 정도 더 포함시켜 더 잘 이해할 수 있도록 함. 

#### Large PR

##### 전략 동기

PR에는 PR-Agent에 필요한 정보와 관련 깊은 정보도 있고 그렇지 않은 정보들도 있는데, 

프롬프트 하나에 정보들을 최대한 포함시키면서도 PR-Agent와 관련된 정보는 유지하기

##### Compression Strategy

삭제보다는 추가에 집중하기

1. 모든 삭제된 파일들을 하나의 리스트로 만들기
2. 삭제 내역만 있는 변경 사항 hunk(변경된 코드 조각)는 삭제하기
    
    hunk는 commit 단위와 다름

##### **Adaptive and token-aware file patch fitting**

1. `tiktoken`을 이용하여 위 압축된 내용을 토큰화
2. 우선순위에 의해 정렬된 변경 사항들을 탐색하며 특정 토큰 한도까지 프롬프트에 추가
3. 한도가 도달했는데 아직 못 넣은 변경 사항들이 있다면, 나머지 변경 내역들은 “other modified files” 라는 리스트로 통합하여 프롬프트에 전달
4. 그래도 못 넣은 변경 사항들은 생략
5. 만약 남은 공간이 있으면 “deleted files” 를 추가하고, 못 넣은 건 생략

### 실행 방법

LLM 설정 후

Guide: https://qodo-merge-docs.qodo.ai/usage-guide/changing_a_model/#azure

- Local(CLI)
    - python 스크립트를 실행하는 형식으로 실행 가능
        
        ```
        python -m pr_agent.cli --pr_url=<pr_url>  /review --pr_reviewer.extra_instructions="focus on the file: ..."
        ```
        
    - 결과를 로컬에서만 확인할 수도 있음    
        
        아래 설정을 추가하면 됨.
    - `publish_output=false` : 결과를 온라인(GitHub)에 게시하지 않고 로컬에만 표시
    - `verbosity_level=2` : 출력 상세 정도를 조절
        
        ```toml
        # configuration.toml
        
        [config]
        
        # 아래 설정을 추가
        publish_output=false
        verbosity_level=2
        ```
        
- Online
    
    온라인에서 실행하기 위해선 각 환경이 PR-Agent 서비스에 어떻게든 접근 가능하게 만들어야 한다.
    
    - PR-Agent 서버 호스팅
        - Webhook 서버 띄우기
            
            FastAPI와 같이 웹 훅 엔드포인트를 제공할 수 있는 서버를 띄우고 엔드포인트와 PR-Agent 로직을 연결하여 사용.
            
        - Github Action workflow 스크립트 작성
    - 사용 방식
        - Comment
            
            Pull Request에 커멘트란에 명령어를 입력하여 실행할 수 있음.
            
            > 이걸 Action 스크립트로 처리하려면 매번 빌드하는 과정이 있기에 오래 걸림
            > 
        - App
            
            Github, Gitlab과 같은 앱에서도 실행할 수 있게 설정을 추가할 수 있다.
            
        - Actions
            
            Github Action, Gitlab Webhook에서도 사용할 수 있다.

---

## AI 코드리뷰의 현재 동향과 미래 전망

### 현재 동향

- **자동화와 통합**   
    CodeRabbit, CriticGPT, Google Jules 등 AI 코드리뷰 도구는 GitHub, GitLab, Azure DevOps 등 주요 플랫폼과 완벽하게 통합되어, Pull Request(PR)나 Merge Request(MR) 생성 시 자동으로 코드 분석과 피드백을 제공합니다.
    
- **컨텍스트 인식 및 고도화**    
    최신 AI 리뷰 도구는 단순히 변경된 코드만 보는 것이 아니라 전체 코드베이스, 아키텍처, 보안 취약점, 성능 이슈까지 종합적으로 분석합니다. 자연어 처리(NLP) 기술이 발전하면서 코드 주석과 문서까지 이해해 더욱 정교한 리뷰가 가능해졌습니다.
    
- **정확성·신뢰성 강화**    
    CriticGPT 등은 기존 AI의 부정확성 문제를 개선하기 위해, 코드의 논리적 오류나 미묘한 버그까지 짚어내는 데 초점을 맞추고 있습니다. AI가 인간 리뷰어가 놓치기 쉬운 부분까지 지적해주면서, 코드 품질과 신뢰성이 함께 향상되고 있습니다.
    
- **팀 학습 및 맞춤화**    
    AI 리뷰 도구는 개발팀의 피드백을 학습해, 팀의 코드 스타일이나 관례에 맞춘 맞춤형 리뷰를 제공합니다. 리뷰 결과와 통계를 통해 팀 전체의 개발 역량 향상에도 기여합니다.
    
- **코드리뷰의 교육 플랫폼화**    
    AI가 단순히 문제를 지적하는 것을 넘어, 주니어 개발자에게 구체적인 개선 방향과 학습 자료를 제공하는 등, 코드리뷰가 팀의 성장 플랫폼으로 진화하고 있습니다.

### 미래 전망

- **하이퍼오토메이션**     
    코드 생성, 리뷰, 배포, 모니터링 등 개발 전 과정에 AI가 관여하는 하이퍼오토메이션이 가속화될 전망입니다. AI는 코드 리뷰를 넘어, 요구사항 분석과 아키텍처 설계까지 지원하게 될 것입니다.
    
- **자율성과 도메인 특화**    
    AI가 스스로 버그를 수정하고, 보안 패치를 적용하며, 특정 기업이나 산업에 최적화된 맞춤형 리뷰를 제공하는 등 자율성과 특화가 강화될 것입니다.
    
- **인간-AI 협업의 심화**   
    AI가 반복적이고 표준화된 리뷰를 담당하고, 인간은 시스템 설계, 창의적 문제 해결, 팀 문화 등 더 고차원적인 영역에 집중하는 분업 구조가 자리잡을 것입니다.

---

## 다양한 AI 코드리뷰 도구의 비교 분석

### 1. **PR Agent (Qodo Merge)**

- **오픈소스 기반 + 기업용 유료 버전(Qodo Merge) 제공**
    - 기본은 무료로 누구나 자가 호스팅 가능하지만, 보안/대규모 관리 기능을 원할 경우 Qodo Merge 플랜을 사용.
- **PR 중심 최적화**
    - PR 생성/수정 이벤트를 자동 감지하고 리뷰를 트리거함.
    - 코드 diff를 요약, 분석해 구체적인 리뷰 코멘트를 생성.
- **슬래시 명령어 지원**
    - `/review`, `/describe`, `/improve`, `/test`, `/docstring`, `/ask` 등 명령어로 자유롭게 추가 요청 가능.
- **보안성 강화**
    - 보안 취약점 탐지, 테스트 생성, 컴플라이언스 대응(SOC2, GDPR 가능) 유료 지원.
- **특징 요약**:
    
    > "코드 리뷰 프로세스를 체계화하고 싶은 팀, 오픈소스/기업 보안이 중요한 프로젝트에 적합."
    > 

---

### 2. **GitHub Copilot**

- **코드 작성 지원에 최적화된 범용 AI**
    - 단순 리뷰 도구가 아니라 "코드 작성 + 코드 리뷰 + 코드 설명 + 자연어 질문 답변"까지 폭넓게 지원.
- **Copilot Chat 기능 제공**
    - "이 코드가 무엇을 하는지 설명해줘", "이 코드를 최적화해줘" 같은 대화형 코드 요청 가능.
- **모델 다양성**
    - 최신 **GPT-4o**, **Claude 3.5 Sonnet** 기반 모델 선택 가능 → 답변의 창의성과 정확성 확보.
- **넓은 통합성**
    - VS Code, JetBrains IDE, GitHub 웹 모두에서 사용 가능.
- **특징 요약**:
    
    > "코드를 더 빠르게 작성하고, 전반적인 개발 생산성을 높이고 싶은 모든 개발자에게 강력 추천."
    > 

---

### 3. **Gemini Code Assist**

- **Google Cloud 기반 강력한 통합**
    - Google Workspace와 Google Cloud 환경과 자연스럽게 연결 → 클라우드 네이티브 개발자에게 특히 유리.
- **180,000회 코드 완성/월 지원**
    - Standard 플랜부터 대용량 코드 작성 지원 가능 → 대형 프로젝트에도 대응.
- **자연어 처리 강화**
    - "이 기능을 추가해줘"처럼 자연어로 기능을 명령할 수 있음.
- **Android Studio 지원**
    - Android 개발자에게 특히 매력적임 (Copilot은 아직 Android Studio 지원이 약함).
- **특징 요약**:
    
    > "Google Cloud 기반의 프로젝트나, Android 개발자에게 최적화된 AI 코드 어시스턴트."
    > 

---

### 4. **CodeRabbit**

- **PR 리뷰 특화**
    - PR 생성되자마자 실시간으로 요약하고, 변경된 코드 라인별로 세밀하게 리뷰.
- **Jira, Linear 연동**
    - 코드 리뷰 과정에서 이슈 생성, 작업 연결 등을 쉽게 할 수 있어 협업툴과 자연스럽게 통합.
- **가볍고 빠른 사용성**
    - 스타트업이나 빠르게 PR을 처리해야 하는 팀에 특히 적합.
- **특징 요약**:
    
    > "PR 리뷰 효율성을 높이고 싶은 애자일 팀이나 스타트업에 적합. 빠른 소통과 연속적 리뷰에 강함."
    >

| 항목 | **PR Agent (Qodo Merge)**                 | **GitHub Copilot**                                           | **Gemini Code Assist**                           | **CodeRabbit**                            |
| --- |-------------------------------------------|--------------------------------------------------------------|--------------------------------------------------|-------------------------------------------|
| **가격** | - 오픈소스: 무료<br/>- Qodo Merge: 월 $19/사용자    | - Pro: 월 $10 <br/> - Pro+: 월 $39 <br/>- Enterprise: 월 $19~39 | - 개인용: 무료- Standard: 월 $22.80- Enterprise: 월 $54 | - Free: 무료- Lite: 월 $12 <br/>- Pro: 월 $25 |
| **주요 기능** | - PR 요약 및 리뷰 자동화- 명령어 기반 상호작용- 보안 취약점 감지  | - 코드 자동 완성- Copilot Chat- 다중 모델 지원                           | - 코드 생성 및 완성- 코드 리뷰- 자연어 명령 처리                   | - PR 요약- 라인별 코드 리뷰- 실시간 채팅                |
| **지원 범위** | - GitHub- GitLab- Bitbucket- Azure DevOps | - VS Code- JetBrains IDEs- GitHub 웹                          | - VS Code- JetBrains IDEs- Android Studio        | - GitHub- GitLab- Azure DevOps            |
| **특징** | - 슬래시 커맨드 지원- 자가 호스팅 가능                   | - GPT-4o, Claude 3.5 Sonnet 등 지원- 다양한 IDE 통합                 | - 최대 180,000 코드 완성/월- Google Cloud 통합            | - 연속적 리뷰- Jira, Linear 등 협업툴 통합           |
| **추천 대상** | - 오픈소스 프로젝트 <br/>- 보안이 중요한 기업                  | - 개인 개발자- 대규모 개발팀                                            | - 개인 개발자 <br/> - Google Cloud 사용자                | - 스타트업- 애자일 팀                             |